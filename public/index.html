<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no" />
    <title>akkosploits</title>

    <link rel="shortcut icon" href="favicon.webp" />

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Oxanium:wght@300;400;500&display=swap" rel="stylesheet">

    <script src="/scram/scramjet.all.js"></script>
    <script src="/baremux/index.js"></script>

    <link rel="stylesheet" href="index.css" />
    <script src="register-sw.js" defer></script>
    <script src="search.js" defer></script>
    <script src="index.js" defer></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
        }

        body {
            min-height: 100vh;
            background: #000000;
            color: #ffffff;
            font-family: 'Oxanium', system-ui, sans-serif;
            font-weight: 300;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        #open-settings-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #202124;
            color: #ffffff;
            border: 1px solid #5f6368;
            border-radius: 9999px;
            padding: 0 24px;
            height: 52px;
            line-height: 52px;
            font-family: 'Oxanium', sans-serif;
            font-size: 1rem;
            font-weight: 300;
            cursor: pointer;
            transition: all 0.18s ease, opacity 0.3s ease;
            z-index: 100;
            outline: none !important;
            -webkit-tap-highlight-color: transparent;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 120px;
            opacity: 1;
        }

        #open-settings-btn.hidden {
            opacity: 0;
            pointer-events: none;
            transform: scale(0.9);
        }

        #open-settings-btn:focus,
        #open-settings-btn:focus-visible,
        #open-settings-btn:active {
            outline: none !important;
            box-shadow: 0 0 0 3px rgba(255,105,180,0.25);
        }

        #open-settings-btn:hover {
            box-shadow: 0 1px 10px rgba(255,255,255,0.12);
            border-color: #8a8c8f;
            transform: translateY(-1px);
        }

        /* Settings Panel Overlay */
        #settings-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.94);
            backdrop-filter: blur(14px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        /* ... rest of settings panel styles unchanged ... */

        .center-wrapper { text-align: center; width: 100%; max-width: 700px; padding: 0 20px; margin-top: -14vh; }
        h1 { font-size: 5.5rem; margin-bottom: 1.8rem; font-weight: 300; letter-spacing: -3px; color: #ffffff; }

        #sj-address {
            width: 100%;
            max-width: 680px;
            height: 52px;
            margin: 0 auto;
            padding: 0 24px;
            font-size: 1.18rem;
            font-weight: 300;
            background: #202124;
            color: #ffffff;
            border: 1px solid #5f6368;
            border-radius: 9999px;
            outline: none !important;
            box-shadow: 0 1px 6px rgba(0,0,0,0.4);
            transition: all 0.18s ease;
            text-align: center;
            font-family: 'Oxanium', sans-serif;
            -webkit-appearance: none;
            appearance: none;
        }

        #sj-address:focus,
        #sj-address:focus-visible,
        #sj-address:active {
            outline: none !important;
            border-radius: 9999px !important;
            box-shadow: 0 0 0 3px rgba(255,105,180,0.3);
            border-color: #ff69b4;
        }

        .error-area { position: fixed; bottom: 2rem; left: 50%; transform: translateX(-50%); color: #ea4335; text-align: center; width: 90%; }

        @media (max-width: 600px) {
            #sj-address { height: 48px; font-size: 1.1rem; padding: 0 20px; }
            h1 { font-size: 4.2rem; }
            #open-settings-btn {
                top: 10px; right: 10px;
                height: 48px; line-height: 48px; padding: 0 20px;
                font-size: 0.95rem;
            }
        }
    </style>
</head>

<body>
    <button id="open-settings-btn" onclick="openSettings()">settings</button>

    <div class="center-wrapper">
        <h1>akkosploits</h1>
        <form id="sj-form">
            <input id="sj-search-engine" value="https://www.google.com/search?q=%s" type="hidden" />
            <input id="sj-address" type="text" placeholder="search whatever you want here - akko!!" autofocus />
        </form>
    </div>

    <!-- settings overlay and rest of HTML unchanged -->

    <script>
        // Your existing functions (openSettings, closeSettings, showTab, etc.) stay the same

        // Hide settings button when inside proxy / search result
        function updateSettingsButtonVisibility() {
            const btn = document.getElementById('open-settings-btn');
            if (!btn) return;

            const path = window.location.pathname;
            const isProxied = 
                path.startsWith('/service/') ||           // common Scramjet prefix
                path.includes('%2F') ||                    // encoded slashes
                path.length > 60 ||                        // unusually long path
                document.querySelector('iframe[src^="http"]'); // rough check for embedded proxied content

            if (isProxied) {
                btn.classList.add('hidden');
            } else {
                btn.classList.remove('hidden');
            }
        }

        // Run on load + when hash / history changes (some proxies use pushState)
        window.addEventListener('load', updateSettingsButtonVisibility);
        window.addEventListener('popstate', updateSettingsButtonVisibility);
        // Some proxies might trigger navigation without full reload
        const originalPushState = history.pushState;
        history.pushState = function() {
            originalPushState.apply(this, arguments);
            setTimeout(updateSettingsButtonVisibility, 50);
        };

        // Also call it after a short delay (in case proxy rewrites DOM late)
        setTimeout(updateSettingsButtonVisibility, 800);

        // Your existing DOMContentLoaded block can stay or be merged
        document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('sj-form');
            form.addEventListener('submit', () => {
                closeSettings();
            });

            // Optional: your existing fetch override can stay if you have it
        });
    </script>
</body>
</html>
