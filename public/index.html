<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no" />
    <title>⠀</title>

    <!-- Blank/invisible favicon -->
    <link rel="icon" href="data:,">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Oxanium:wght@300;400;500&display=swap" rel="stylesheet">

    <script src="/scram/scramjet.all.js"></script>
    <script src="/baremux/index.js"></script>

    <link rel="stylesheet" href="index.css" />
    <script src="register-sw.js" defer></script>
    <script src="search.js" defer></script>
    <script src="index.js" defer></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            min-height: 100vh;
            background: #000000;
            color: #ffffff;
            font-family: 'Oxanium', system-ui, sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .pill-element {
            background: #202124;
            color: #ffffff;
            border: none !important;
            outline: none !important;
            border-radius: 9999px !important;
            font-family: 'Oxanium', sans-serif;
            transition: all 0.2s ease;
        }

        .top-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 25px;
            font-size: 1rem;
            cursor: pointer;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .top-btn:hover, #sj-address:hover {
            background: #2d2e31;
            transform: translateY(-1px);
        }

        #home-btn { display: none; }

        #sj-form { width: 100%; }

        #sj-address {
            width: 100%;
            height: 54px;
            padding: 0 30px;
            font-size: 1.2rem;
            text-align: center;
            background: #0f0f0f;
            color: #ffffff;
            border: 1px solid #222;
        }

        #sj-address::placeholder {
            color: #aaa;
            opacity: 1;
        }

        #sj-address:focus {
            background: #1a1a1a;
            border-color: #444;
        }

        #settings-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.9);
            backdrop-filter: blur(15px);
            display: none; 
            align-items: center;
            justify-content: center;
            z-index: 9999;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        #settings-overlay.active { display: flex; opacity: 1; }

        #settings-panel {
            background: #0f0f0f;
            border-radius: 20px;
            width: 90%;
            max-width: 650px;
            height: 70vh;
            display: flex;
            position: relative;
            transform: scale(0.9);
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            overflow: hidden;
        }

        #settings-overlay.active #settings-panel { transform: scale(1); }

        #close-settings {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 2.5rem;
            cursor: pointer;
            color: #666;
            z-index: 10;
        }

        .sidebar { width: 180px; background: #111; padding: 30px 0; }
        .sidebar-header { padding: 0 20px; margin-bottom: 20px; font-weight: 600; font-size: 1.2rem; }
        .sidebar-item { padding: 12px 20px; color: #777; cursor: pointer; }
        .sidebar-item.active { color: #fff; background: #1a1a1a; }

        .content-area { flex: 1; padding: 40px; color: #ccc; overflow-y: auto; }
        .section-title { color: #fff; margin-bottom: 20px; }

        .dark-gray-btn {
            background: #1c1c1c; color: #fff; border: none;
            width: 100%; padding: 15px; border-radius: 12px;
            cursor: pointer; margin-top: 10px; font-family: inherit;
        }

        .setting-row { display: flex; justify-content: space-between; align-items: center; margin-top: 25px; }
        .switch { position: relative; width: 50px; height: 26px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; inset: 0; background-color: #333; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #ff69b4; }
        input:checked + .slider:before { transform: translateX(24px); }

        @media (max-width: 600px) {
            h1 { font-size: 3.5rem; }
            .sidebar { width: 120px; }
        }
    </style>
</head>
<body>
    <button id="open-settings-btn" class="pill-element top-btn" onclick="openSettings()">settings</button>
    <button id="home-btn" class="pill-element top-btn" onclick="goHome()">home</button>

    <div id="main-ui" class="center-wrapper">
        <h1 onclick="goHome()">akkosploits</h1>
        <form id="sj-form">
            <input id="sj-search-engine" value="https://www.google.com/search?q=%s" type="hidden" />
            <input id="sj-address" class="pill-element" type="text" placeholder="search whatever you want here - akko!!" autofocus />
        </form>
    </div>

    <div id="settings-overlay" onclick="if(event.target === this) closeSettings()">
        <div id="settings-panel">
            <span id="close-settings" onclick="closeSettings()">×</span>
            <div class="sidebar">
                <div class="sidebar-header">settings</div>
                <div class="sidebar-items">
                    <div id="cloaking-tab" onclick="showTab('cloaking')" class="sidebar-item active">cloaking</div>
                    <div id="about-tab" onclick="showTab('about')" class="sidebar-item">about</div>
                </div>
            </div>
            <div class="content-area">
                <div id="cloaking-content">
                    <h3 class="section-title">cloaking</h3>
                    <button onclick="ab_cloakReal()" class="dark-gray-btn">Open About:Blank</button>
                    <div class="setting-row">
                        <span>Auto About:Blank</span>
                        <label class="switch">
                            <input type="checkbox" id="auto-cloak-toggle" onchange="toggleAutoCloak()">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
                <div id="about-content" style="display:none;">
                    <h3 class="section-title">about</h3>
                    <p style="color:#777; text-align:center; margin-top:40px;">v1.0 - akkosploits</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ────────────────────────────────────────────────
        //  Core elements
        // ────────────────────────────────────────────────
        const sjForm        = document.getElementById('sj-form');
        const settingsBtn   = document.getElementById('open-settings-btn');
        const homeBtn       = document.getElementById('home-btn');
        const overlay       = document.getElementById('settings-overlay');
        const mainUI        = document.getElementById('main-ui');

        // Detect if we are inside the cloaked about:blank → iframe situation
        const isCloaked = 
            window.location.href === '' ||
            window.location.href === 'about:blank' ||
            window.location.href.startsWith('about:') ||
            (window.frameElement && window.frameElement.tagName === 'IFRAME');

        // Apply correct UI state right away
        if (isCloaked) {
            if (mainUI)        mainUI.style.display = 'none';
            if (settingsBtn)   settingsBtn.style.display = 'none';
            if (homeBtn)       homeBtn.style.display = 'flex';
        } else {
            if (homeBtn)       homeBtn.style.display = 'none';
        }

        // ────────────────────────────────────────────────
        //  Home button – works in both normal & cloaked view
        // ────────────────────────────────────────────────
        function goHome() {
            if (isCloaked) {
                // In cloaked tab → reload the top-level window
                window.top.location.reload();
                return;
            }

            // Normal view
            if (mainUI)        mainUI.style.display = 'block';
            if (settingsBtn)   settingsBtn.style.display = 'flex';
            if (homeBtn)       homeBtn.style.display = 'none';

            const addressInput = document.getElementById('sj-address');
            if (addressInput)  addressInput.value = '';

            window.location.reload();
        }

        // ────────────────────────────────────────────────
        //  Search form submit → hide main UI, show home
        // ────────────────────────────────────────────────
        if (sjForm) {
            sjForm.addEventListener('submit', (e) => {
                // Uncomment next line if your proxy in search.js needs it
                // e.preventDefault();

                if (mainUI)      mainUI.style.display = 'none';
                if (settingsBtn) settingsBtn.style.display = 'none';
                if (homeBtn)     homeBtn.style.display = 'flex';
            });
        }

        function openSettings() { 
            if (isCloaked) return; // optional: disable settings while cloaked
            overlay.style.display = 'flex';
            setTimeout(() => overlay.classList.add('active'), 10);
        }

        function closeSettings() { 
            overlay.classList.remove('active');
            setTimeout(() => overlay.style.display = 'none', 300);
        }

        function showTab(tab) {
            document.getElementById('cloaking-content').style.display = tab === 'cloaking' ? 'block' : 'none';
            document.getElementById('about-content').style.display = tab === 'about' ? 'block' : 'none';
            document.querySelectorAll('.sidebar-item').forEach(item => item.classList.remove('active'));
            document.getElementById(tab + '-tab').classList.add('active');
        }

        window.addEventListener('load', () => {
            const isEnabled = localStorage.getItem('autoCloak') === 'true';
            const toggle = document.getElementById('auto-cloak-toggle');
            if (toggle) toggle.checked = isEnabled;
            if (isEnabled) ab_cloakReal();
        });

        function toggleAutoCloak() {
            localStorage.setItem('autoCloak', document.getElementById('auto-cloak-toggle').checked);
        }

        function ab_cloakReal() {
            const iframe = document.createElement("iframe");
            iframe.src = window.location.href;
            iframe.style = "width:100%; height:100%; border:none; margin:0; padding:0; overflow:hidden;";
            const win = window.open("about:blank", "_blank");
            if (win) {
                win.document.body.style = "margin:0; padding:0; height:100vh; width:100vw;";
                win.document.body.appendChild(iframe);
            }
        }
    </script>
</body>
</html>
